#@ load("@ytt:overlay", "overlay")
#@ load("@ytt:template", "template")
#@ load("@ytt:data", "data")
#@ load("/lib/certificates.lib.yml", "generate_dns_names", "generate_self_signed_issuer", "generate_certificate")

#@ name = data.values.name
#@ namespace = data.values.namespace
#@ common_name = data.values.certificate.commonName
#@ dns_names = data.values.certificate.dnsNames
#@ issuer_name = name

#@ cert = name + "-cert"
#@ cert_subject = data.values.certificate.subject
#@ cert_secret_name = name + "-tls"
#@ cert_duration = data.values.certificate.duration
#@ cert_renew_before = data.values.certificate.renewBefore
#@ cert_common_name = name

#@ if data.values.certificate.generate:
--- #@ generate_self_signed_issuer(name,namespace)
--- #@ generate_certificate(name,namespace,cert_duration,cert_renew_before,cert_secret_name,common_name,dns_names,cert_subject,issuer_name)

#! --- #@ generate_ca_issuer(ca_issuer, namespace, ca_key_pair)
#! --- #@ generate_server_certificate(cert, namespace, cert_duration, cert_renew_before, secret, [organization], cert_common_name, generate_dns_names(name, namespace), ca_issuer)
#! --- #@ generate_client_certificate(envoy_cert, namespace, cert_duration, cert_renew_before, envoy_secret, [organization], envoy_cert_common_name, generate_dns_names(envoy_name, namespace), ca_issuer)
#@ end
